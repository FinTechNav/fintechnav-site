<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dejavoo Freedom to Design - Payment Test</title>
    <style>
      :root {
        --color-background: #1a1a1a;
        --color-background-secondary: #2a2a2a;
        --color-text: #e0e0e0;
        --color-primary: #c9a15f;
        --color-primary-hover: #b08f4f;
        --color-border: rgba(201, 161, 95, 0.3);
        --color-success: #4caf50;
        --color-error: #f44336;
        --color-warning: #ff9800;
        --border-radius: 8px;
        --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-family);
        background-color: var(--color-background);
        color: var(--color-text);
        padding: 20px;
        line-height: 1.6;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background-color: var(--color-background-secondary);
        border-radius: var(--border-radius);
        padding: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }

      h1 {
        color: var(--color-primary);
        margin-bottom: 10px;
        font-size: 2rem;
        text-align: center;
      }

      .subtitle {
        text-align: center;
        color: #888;
        margin-bottom: 30px;
        font-size: 0.9rem;
      }

      .section {
        margin-bottom: 30px;
        padding: 20px;
        background-color: var(--color-background);
        border-radius: var(--border-radius);
        border: 1px solid var(--color-border);
      }

      .section h2 {
        color: var(--color-primary);
        margin-bottom: 15px;
        font-size: 1.4rem;
        border-bottom: 2px solid var(--color-border);
        padding-bottom: 10px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--color-primary);
      }

      input[type='text'],
      input[type='number'],
      select {
        width: 100%;
        padding: 12px;
        background-color: var(--color-background-secondary);
        border: 1px solid var(--color-border);
        border-radius: var(--border-radius);
        color: var(--color-text);
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      input[type='text']:focus,
      input[type='number']:focus,
      select:focus {
        outline: none;
        border-color: var(--color-primary);
      }

      .help-text {
        font-size: 0.85rem;
        color: #888;
        margin-top: 5px;
      }

      .btn {
        background-color: var(--color-primary);
        color: #1a1a1a;
        padding: 12px 30px;
        border: none;
        border-radius: var(--border-radius);
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 10px;
      }

      .btn:hover:not(:disabled) {
        background-color: var(--color-primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(201, 161, 95, 0.3);
      }

      .btn:disabled {
        background-color: #555;
        cursor: not-allowed;
        opacity: 0.5;
        transform: none;
      }

      #payment-form-container {
        min-height: 400px;
        background-color: var(--color-background-secondary);
        border: 2px dashed var(--color-border);
        border-radius: var(--border-radius);
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #888;
      }

      #payment-form-container.loaded {
        border-style: solid;
        background-color: transparent;
        display: block;
        align-items: initial;
        justify-content: initial;
      }

      .alert {
        padding: 15px;
        border-radius: var(--border-radius);
        margin-top: 20px;
        font-weight: 500;
      }

      .alert-success {
        background-color: rgba(76, 175, 80, 0.2);
        border: 1px solid var(--color-success);
        color: var(--color-success);
      }

      .alert-error {
        background-color: rgba(244, 67, 54, 0.2);
        border: 1px solid var(--color-error);
        color: var(--color-error);
      }

      .alert-warning {
        background-color: rgba(255, 152, 0, 0.2);
        border: 1px solid var(--color-warning);
        color: var(--color-warning);
      }

      .alert-info {
        background-color: rgba(33, 150, 243, 0.2);
        border: 1px solid #2196f3;
        color: #2196f3;
      }

      .response-data {
        background-color: var(--color-background);
        padding: 15px;
        border-radius: var(--border-radius);
        margin-top: 15px;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        overflow-x: auto;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .config-status {
        padding: 10px;
        border-radius: var(--border-radius);
        margin-top: 10px;
        text-align: center;
        font-size: 0.9rem;
      }

      .status-ready {
        background-color: rgba(76, 175, 80, 0.2);
        color: var(--color-success);
      }

      .status-missing {
        background-color: rgba(244, 67, 54, 0.2);
        color: var(--color-error);
      }

      .documentation-links {
        background-color: var(--color-background);
        padding: 15px;
        border-radius: var(--border-radius);
        margin-top: 20px;
      }

      .documentation-links h3 {
        color: var(--color-primary);
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      .documentation-links a {
        color: #64b5f6;
        text-decoration: none;
        display: block;
        margin: 5px 0;
        transition: color 0.3s ease;
      }

      .documentation-links a:hover {
        color: var(--color-primary);
        text-decoration: underline;
      }

      .warning-box {
        background-color: rgba(255, 152, 0, 0.1);
        border-left: 4px solid var(--color-warning);
        padding: 15px;
        margin-bottom: 20px;
        border-radius: var(--border-radius);
      }

      .warning-box h3 {
        color: var(--color-warning);
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      .info-box {
        background-color: rgba(201, 161, 95, 0.1);
        border-left: 4px solid var(--color-primary);
        padding: 15px;
        margin-top: 20px;
        border-radius: var(--border-radius);
      }

      .info-box h4 {
        color: var(--color-primary);
        margin-bottom: 10px;
        font-size: 1rem;
      }

      .info-box ul,
      .info-box ol {
        margin-left: 20px;
        margin-top: 10px;
        line-height: 1.8;
      }

      .info-box ul ul {
        margin-top: 5px;
      }

      .email-template {
        background-color: var(--color-background-secondary);
        padding: 15px;
        border-radius: var(--border-radius);
        margin-top: 15px;
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        white-space: pre-wrap;
        border: 1px solid var(--color-border);
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 1.5rem;
        }

        .section h2 {
          font-size: 1.2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Dejavoo Freedom to Design</h1>
      <p class="subtitle">Payment Integration Test Page</p>

      <!-- Warning Box for Library Status -->
      <div class="warning-box" id="libraryWarning" style="display: none;">
        <h3>‚ö†Ô∏è Library Status</h3>
        <p id="libraryWarningText"></p>
      </div>

      <!-- Configuration Section -->
      <div class="section">
        <h2>Configuration</h2>
        <div class="form-group">
          <label for="authToken">eComm Auth Token:</label>
          <input
            type="text"
            id="authToken"
            placeholder="Enter your Dejavoo eComm Auth Token"
          />
          <div class="help-text">
            Required: Your authentication token from Dejavoo. Contact devsupport@dejavoo.io if
            you need assistance.
          </div>
        </div>

        <div class="form-group">
          <label for="amount">Transaction Amount (in cents):</label>
          <input type="number" id="amount" value="1000" min="1" />
          <div class="help-text">Amount in cents (e.g., 1000 = $10.00)</div>
        </div>

        <div class="form-group">
          <label for="environment">Environment:</label>
          <select id="environment">
            <option value="sandbox">Sandbox (Testing)</option>
            <option value="production">Production (Live)</option>
          </select>
          <div class="help-text">Start with Sandbox for testing</div>
        </div>

        <button class="btn" id="initializeBtn" onclick="initializePaymentForm()">
          Initialize Payment Form
        </button>

        <div id="configStatus"></div>
      </div>

      <!-- Payment Form Section -->
      <div class="section">
        <h2>Payment Form</h2>
        <div id="payment-form-container">
          <p>Click "Initialize Payment Form" above to load the payment interface</p>
        </div>
      </div>

      <!-- Results Section -->
      <div class="section" id="resultsSection" style="display: none">
        <h2>Transaction Results</h2>
        <div id="resultMessage"></div>
        <div id="responseData" class="response-data"></div>
      </div>

      <!-- Documentation Links -->
      <div class="documentation-links">
        <h3>üìö Documentation & Resources</h3>
        <a href="https://docs.ipospays.com/freedom-to-design" target="_blank">
          Freedom to Design Overview
        </a>
        <a href="https://docs.ipospays.com/freedom-to-design/apidocs" target="_blank">
          API Documentation
        </a>
        <a href="https://simulator.ipostransact.com/" target="_blank">
          iPOStransact API Simulator (ACH Form)
        </a>
        <p style="margin-top: 15px; color: #888; font-size: 0.85rem">
          For technical support, email:
          <a href="mailto:devsupport@dejavoo.io">devsupport@dejavoo.io</a>
        </p>
      </div>
    </div>

    <!-- Load Freedom to Design Library with error handling -->
    <script>
      // Track library load status
      let libraryLoaded = false;

      // Create script element with error handling
      (function loadLibrary() {
        const script = document.createElement('script');
        script.src = 'https://payment.ipospays.com/ftd/v1/freedomtodesign.js';
        
        script.onload = function() {
          libraryLoaded = true;
          console.log('‚úÖ FreedomToDesign library loaded successfully');
        };
        
        script.onerror = function() {
          console.error('‚ùå Failed to load FreedomToDesign library');
          showLibraryWarning(false);
        };
        
        document.head.appendChild(script);
      })();

      function showLibraryWarning(success) {
        const warning = document.getElementById('libraryWarning');
        const warningText = document.getElementById('libraryWarningText');
        warning.style.display = 'block';
        
        if (success) {
          warning.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
          warning.style.borderColor = 'var(--color-success)';
          warning.querySelector('h3').style.color = 'var(--color-success)';
          warning.querySelector('h3').textContent = '‚úÖ Library Status';
          warningText.style.color = 'var(--color-success)';
          warningText.textContent = 'FreedomToDesign library loaded successfully and ready to use!';
        } else {
          warningText.textContent = 'The FreedomToDesign JavaScript library could not be loaded from the CDN. This is expected if the library requires authentication or special access. See troubleshooting information below when you click "Initialize Payment Form".';
        }
      }
    </script>

    <!-- Application Logic -->
    <script>
      let paymentFormInitialized = false;

      function initializePaymentForm() {
        // Check if library is available
        if (typeof FreedomToDesign === 'undefined') {
          showLibraryNotAvailable();
          return;
        }

        // Get configuration values
        const authToken = document.getElementById('authToken').value.trim();
        const amount = document.getElementById('amount').value;
        const environment = document.getElementById('environment').value;

        // Validate inputs
        if (!authToken) {
          showConfigStatus('error', 'Please enter your Auth Token');
          return;
        }

        if (!amount || amount < 1) {
          showConfigStatus('error', 'Please enter a valid amount');
          return;
        }

        // Show loading state
        showConfigStatus('info', 'Initializing payment form...');
        document.getElementById('initializeBtn').disabled = true;

        // Clear the container
        const container = document.getElementById('payment-form-container');
        container.innerHTML = '';
        container.classList.add('loaded');

        try {
          // Initialize FreedomToDesign
          // Based on Serena's example - may need adjustment
          FreedomToDesign.init({
            container: '#payment-form-container',
            authToken: authToken,
            amount: parseInt(amount),
            environment: environment,
            onSuccess: function (response) {
              handleSuccess(response);
            },
            onError: function (error) {
              handleError(error);
            },
            onCancel: function () {
              handleCancel();
            },
          });

          paymentFormInitialized = true;
          showConfigStatus('success', 'Payment form initialized successfully!');
        } catch (error) {
          console.error('Initialization error:', error);
          showConfigStatus('error', `Initialization failed: ${error.message}`);
          document.getElementById('initializeBtn').disabled = false;
          container.classList.remove('loaded');
          container.innerHTML = '<p>Failed to initialize. Check console for details.</p>';
        }
      }

      function showLibraryNotAvailable() {
        const container = document.getElementById('payment-form-container');
        container.classList.add('loaded');
        container.innerHTML = `
          <div style="text-align: left;">
            <h3 style="color: var(--color-error); margin-bottom: 15px;">‚ö†Ô∏è FreedomToDesign Library Not Available</h3>
            
            <p style="margin-bottom: 15px;">The Dejavoo FreedomToDesign JavaScript library is not loading. This could be because:</p>
            <ul style="margin-left: 20px; margin-bottom: 20px; line-height: 1.8;">
              <li>The library URL is incorrect or has changed</li>
              <li>The library requires authentication before it can be loaded</li>
              <li>Your account may not have Freedom to Design feature access yet</li>
              <li>There may be CORS (Cross-Origin Resource Sharing) restrictions</li>
              <li>The library may only be available in a different environment</li>
            </ul>
            
            <div class="info-box">
              <h4>üìß Contact Dejavoo Support</h4>
              <p>Email <a href="mailto:devsupport@dejavoo.io" style="color: #64b5f6;">devsupport@dejavoo.io</a> and ask for:</p>
              <ol>
                <li>The correct script URL for the FreedomToDesign library</li>
                <li>Confirmation that your account has Freedom to Design enabled</li>
                <li>A working code example or demo page</li>
                <li>Any additional setup steps required</li>
                <li>Documentation for the init() method parameters</li>
              </ol>
            </div>

            <div class="info-box">
              <h4>üîç Your Integration Requirements</h4>
              <ul>
                <li><strong>SoftPOS</strong>: Tap to pay for iPhone and Android phones/tablets</li>
                <li><strong>SPIn API</strong>: Reader/terminal support for iPad</li>
              </ul>
              <p style="margin-top: 10px;">Make sure to mention these requirements when contacting support.</p>
            </div>

            <div class="info-box">
              <h4>üí° Alternative Testing</h4>
              <p>While waiting for support response:</p>
              <ul>
                <li>Test with the <a href="https://simulator.ipostransact.com/" target="_blank" style="color: #64b5f6;">iPOStransact API Simulator</a></li>
                <li>Review the <a href="https://docs.ipospays.com/freedom-to-design" target="_blank" style="color: #64b5f6;">API documentation</a></li>
                <li>Check the <a href="https://docs.ipospays.com/freedom-to-design/apidocs" target="_blank" style="color: #64b5f6;">API reference</a></li>
              </ul>
            </div>

            <div class="email-template">
<strong>üìã Suggested Email Template:</strong>

Subject: Freedom to Design Integration - Script Loading Issue

Hi Dejavoo Support Team,

I'm working on integrating the Freedom to Design payment solution and need assistance with the JavaScript library.

<strong>Issue:</strong>
The FreedomToDesign library is not loading from:
https://payment.ipospays.com/ftd/v1/freedomtodesign.js

<strong>My Use Case:</strong>
- Implementing SoftPOS (tap to pay) for iPhone and Android
- Implementing SPIn API for iPad reader/terminal support

<strong>Questions:</strong>
1. What is the correct URL to load the FreedomToDesign library?
2. Does my account have Freedom to Design access enabled?
3. Can you provide a working code example or demo page?
4. Are there any authentication requirements before the library loads?
5. What are the correct parameters for the FreedomToDesign.init() method?

<strong>Current Setup:</strong>
- Environment: [Sandbox/Production]
- Auth Token: [Have/Need]

Any guidance or documentation you can provide would be greatly appreciated.

Thank you,
Brad Jensen
brad@fintechnav.com
            </div>
          </div>
        `;
        
        showConfigStatus('error', 'FreedomToDesign library not available - see details above');
      }

      function handleSuccess(response) {
        console.log('Payment successful:', response);
        document.getElementById('resultsSection').style.display = 'block';
        document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });

        const resultMessage = document.getElementById('resultMessage');
        resultMessage.className = 'alert alert-success';
        resultMessage.innerHTML = '<strong>‚úì Payment Successful!</strong><br>Transaction completed successfully.';

        document.getElementById('responseData').textContent = JSON.stringify(response, null, 2);

        setTimeout(() => resetForm(), 5000);
      }

      function handleError(error) {
        console.error('Payment error:', error);
        document.getElementById('resultsSection').style.display = 'block';
        document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });

        const resultMessage = document.getElementById('resultMessage');
        resultMessage.className = 'alert alert-error';
        resultMessage.innerHTML = `<strong>‚úó Payment Failed</strong><br>${error.message || 'An error occurred during payment processing.'}`;

        document.getElementById('responseData').textContent = JSON.stringify(error, null, 2);
        document.getElementById('initializeBtn').disabled = false;
      }

      function handleCancel() {
        console.log('Payment cancelled by user');
        document.getElementById('resultsSection').style.display = 'block';
        document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });

        const resultMessage = document.getElementById('resultMessage');
        resultMessage.className = 'alert alert-info';
        resultMessage.innerHTML = '<strong>Payment Cancelled</strong><br>The transaction was cancelled by the user.';

        document.getElementById('responseData').textContent = 'No transaction data available.';
        document.getElementById('initializeBtn').disabled = false;
      }

      function resetForm() {
        document.getElementById('payment-form-container').innerHTML = '<p>Click "Initialize Payment Form" above to start a new transaction</p>';
        document.getElementById('payment-form-container').classList.remove('loaded');
        document.getElementById('initializeBtn').disabled = false;
        paymentFormInitialized = false;
      }

      function showConfigStatus(type, message) {
        const statusDiv = document.getElementById('configStatus');
        statusDiv.className = 'config-status';

        if (type === 'success') {
          statusDiv.classList.add('status-ready');
        } else if (type === 'error') {
          statusDiv.classList.add('status-missing');
        } else {
          statusDiv.style.backgroundColor = 'rgba(33, 150, 243, 0.2)';
          statusDiv.style.color = '#2196f3';
        }

        statusDiv.textContent = message;
        statusDiv.style.display = 'block';
      }

      // Check library status after page load
      window.addEventListener('load', function () {
        setTimeout(function() {
          if (typeof FreedomToDesign !== 'undefined') {
            console.log('‚úÖ FreedomToDesign library ready');
            showLibraryWarning(true);
          } else {
            console.warn('‚ö†Ô∏è FreedomToDesign library not available');
          }
        }, 1000);
      });

      // Save form values to localStorage
      document.getElementById('authToken').addEventListener('change', function () {
        localStorage.setItem('dejavoo_auth_token', this.value);
      });

      document.getElementById('amount').addEventListener('change', function () {
        localStorage.setItem('dejavoo_amount', this.value);
      });

      document.getElementById('environment').addEventListener('change', function () {
        localStorage.setItem('dejavoo_environment', this.value);
      });

      // Load saved values on page load
      window.addEventListener('load', function () {
        const savedToken = localStorage.getItem('dejavoo_auth_token');
        const savedAmount = localStorage.getItem('dejavoo_amount');
        const savedEnvironment = localStorage.getItem('dejavoo_environment');

        if (savedToken) document.getElementById('authToken').value = savedToken;
        if (savedAmount) document.getElementById('amount').value = savedAmount;
        if (savedEnvironment) document.getElementById('environment').value = savedEnvironment;
      });
    </script>
  </body>
</html>